# üöÄ Railway Deployment Guide

Este proyecto est√° configurado para desplegarse autom√°ticamente en Railway.

## Pre-requisitos

1. Cuenta en [Railway](https://railway.app)
2. C√≥digo en un repositorio de GitHub
3. Railway CLI instalado (opcional)

## Pasos para el despliegue

### 1. Crear proyecto en Railway

```bash
# Opci√≥n A: Desde la web
# 1. Ve a https://railway.app
# 2. Conecta tu cuenta de GitHub
# 3. Selecciona "Deploy from GitHub repo"
# 4. Elige este repositorio

# Opci√≥n B: Desde CLI
railway login
railway project:new
railway link
```

### 2. Configurar base de datos

```bash
# En Railway dashboard o CLI:
railway add --database postgresql
```

### 3. Configurar variables de entorno

En el dashboard de Railway, agrega estas variables:

**Required:**

```
API_KEY=your-secure-api-key-here-change-this
NODE_ENV=production
LOG_LEVEL=info
```

**Optional (for CORS):**

```
FRONTEND_URL=https://your-frontend-domain.com
```

**Auto-generated by Railway:**

- `DATABASE_URL` (autom√°tico con PostgreSQL)
- `RAILWAY_STATIC_URL` (autom√°tico)

### 4. Configurar dominio (opcional)

1. En Railway dashboard ‚Üí tu proyecto
2. Settings ‚Üí Domains
3. Generate Domain o agregar dominio personalizado

### 5. Deploy

El despliegue es autom√°tico cuando pusheas a `main`:

```bash
git add .
git commit -m "Deploy to Railway"
git push origin main
```

## Comandos de Railway CLI

```bash
# Logs del deployment
railway logs

# Abrir la app
railway open

# Conectar a la base de datos
railway connect postgresql

# Variables de entorno
railway variables

# Ejecutar migraciones manualmente
railway run yarn prisma:deploy

# Ejecutar seed manualmente
railway run yarn railway:seed
```

## Verificaci√≥n del despliegue

1. **Health check**: `https://your-app.railway.app/health`
2. **API info**: `https://your-app.railway.app/api`
3. **Documentaci√≥n**: `https://your-app.railway.app/docs`
4. **Test endpoint**:
   ```bash
   curl -H "X-API-Key: your-api-key" \
        https://your-app.railway.app/api/v1/spaces
   ```

## Configuraci√≥n autom√°tica

Este proyecto est√° optimizado para Railway con:

‚úÖ **Auto-detecci√≥n**: Railway detecta autom√°ticamente Node.js
‚úÖ **Node.js 20**: Configurado en `.nvmrc` y `package.json`
‚úÖ **Yarn**: Detectado autom√°ticamente por `yarn.lock`
‚úÖ **Migraciones autom√°ticas**: Se ejecutan en el script `start`
‚úÖ **Health checks**: Configurados para producci√≥n
‚úÖ **Logging**: Optimizado para Railway
‚úÖ **Dockerfile**: Multi-stage build como fallback

## Soluci√≥n de problemas

### Build failures

```bash
# Ver logs detallados
railway logs --deployment

# Revisar variables de entorno
railway variables
```

### Database issues

```bash
# Conectar a la base de datos
railway connect postgresql

# Ejecutar migraciones manualmente
railway run yarn prisma:deploy

# Ver estado de la base de datos
railway run yarn db:verify
```

### Environment variables

```bash
# Listar todas las variables
railway variables

# Agregar variable
railway variables:set API_KEY=your-new-key

# Ver una variable espec√≠fica
railway variables:get DATABASE_URL
```

## Monitoreo

Railway proporciona autom√°ticamente:

- üìä M√©tricas de CPU y memoria
- üìà Gr√°ficos de tr√°fico
- üîç Logs en tiempo real
- ‚ö° Reinicio autom√°tico en caso de fallos

## URLs importantes

- **Producci√≥n**: `https://your-app.railway.app`
- **Health check**: `https://your-app.railway.app/health`
- **API docs**: `https://your-app.railway.app/docs`
- **Railway dashboard**: `https://railway.app/dashboard`
